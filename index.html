<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRNI vs BELI – CRNI vs BELI</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

  <!-- Football Manager–style font -->
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Exo 2', sans-serif;
      background-color: #f0f2f5;
    }

    /* HERO */
    .hero {
      background: linear-gradient(135deg, #f2f2f2, #d9d9d9);
      color: #1a1a2e;
      padding: 80px 0;
      text-align: center;
    }

    /* MATCH BOXES */
    .match-box {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 20px;
      background-color: #ffffff;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .match-box img {
      height: 60px;
      width: auto;
      margin: 0 15px;
      object-fit: contain;
    }

    .score-highlight {
      color: #fff;
      background: red;
      font-size: 2.2em;
      font-weight: bold;
      padding: 6px 20px;
      border-radius: 6px;
      margin: 0 25px;
    }

    /* Table Logos */
    .league-table-logo {
      height: 30px;
      width: auto;
      vertical-align: middle;
      margin-right: 8px;
    }
    .league-top {
      background: linear-gradient(90deg, #ffd700, #ffa500);
      color: #000;
      font-weight: bold;
    }

    /* Previous Matches Team Labels */
    .team-crni {
      color: white;
      background: black;
      padding: 3px 8px;
      border-radius: 4px;
    }
    .team-beli {
      color: black;
      background: white;
      padding: 3px 8px;
      border-radius: 4px;
      border: 1px solid #000;
    }

    footer {
      background: #111;
      color: #eee;
      text-align: center;
      padding: 20px 0;
      margin-top: 40px;
    }
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark" style="background:#0f0f1d;">
  <div class="container">
    <a class="navbar-brand" href="#">CRNI vs BELI</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#nav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="nav" class="collapse navbar-collapse">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item"><a class="nav-link" href="#home">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="#tablesContainer">League Table</a></li>
        <li class="nav-item"><a class="nav-link" href="#results">Previous Matches</a></li>
        <li class="nav-item"><a class="nav-link" href="#playerStats">Player Stats</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- HERO / LATEST + NEXT MATCH -->
<section id="home" class="hero">
  <div class="container">
    <h1 class="display-5">Crno-Beli Derbi</h1>

    <div class="row mt-5 justify-content-center">
      <div class="col-md-6">

        <div class="match-box" id="latestMatch"></div>

        <div class="match-box" id="nextMatch"></div>

      </div>
    </div>
  </div>
</section>

<!-- TABLES + PREVIOUS MATCHES -->
<section class="py-5 bg-light">
  <div class="container" id="tablesContainer"></div>
</section>

<!-- PLAYER STATS -->
<section id="playerStats" class="py-5 bg-white">
  <div class="container">
    <h2 class="text-center mb-4">Player Stats</h2>

    <table class="table table-bordered table-striped">
      <thead class="thead-dark">
        <tr>
          <th>#</th>
          <th>Player</th>
          <th>CRNI Appearances</th>
          <th>BELI Appearances</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="playerStatsBody"></tbody>
    </table>
  </div>
</section>

<footer>
  <p>&copy; 2025 CRNI vs BELI</p>
</footer>

<!-- SCRIPT -->
<script>
document.addEventListener("DOMContentLoaded", () => {

  fetch("data.json")
    .then(r => r.json())
    .then(data => {

      /* -------------------------------
         LATEST MATCH
      --------------------------------*/
      const latest = data.latestMatch;

      document.getElementById("latestMatch").innerHTML = `
        <h3>Latest Match</h3><hr>
        <div style="display:flex; align-items:center; justify-content:center; font-size:1.2em;">
          <img src="${latest.homeLogo}">
          <strong style="margin:0 15px;">${latest.home}</strong>
          <span class="score-highlight">${latest.score}</span>
          <strong style="margin:0 15px;">${latest.away}</strong>
          <img src="${latest.awayLogo}">
        </div>
        <p class="mt-3">Date: ${latest.date}</p>
        <p>Stadium: ${latest.stadium}</p>
      `;

      /* -------------------------------
         NEXT MATCH + COUNTDOWN
      --------------------------------*/
      const next = data.nextMatch;
      const nextMatchEl = document.getElementById("nextMatch");

      nextMatchEl.innerHTML = `
        <h3>Next Match</h3><hr>
        <div style="display:flex; align-items:center; justify-content:center; font-size:1.2em;">
          <img src="${next.homeLogo}">
          <strong style="margin:0 15px;">${next.home}</strong> vs
          <strong style="margin:0 15px;">${next.away}</strong>
          <img src="${next.awayLogo}">
        </div>
        <p class="mt-3">Date: ${next.date}</p>
        <p>Stadium: ${next.stadium}</p>
        <div id="countdown" style="font-size:1.5em; font-weight:bold; margin-top:12px;"></div>
      `;

      function startCountdown(dateStr) {
        const el = document.getElementById("countdown");
        const [d, m, y] = dateStr.split(".");
        const target = new Date(`${y}-${m}-${d}T15:00:00`);

        function tick() {
          const now = new Date();
          const diff = target - now;

          if (diff <= 0) {
            el.innerHTML = "Match is live!";
            return;
          }

          const days = Math.floor(diff / 86400000);
          const hours = Math.floor((diff % 86400000) / 3600000);
          const mins = Math.floor((diff % 3600000) / 60000);
          const secs = Math.floor((diff % 60000) / 1000);

          el.innerHTML = `Starts in: ${days}d ${hours}h ${mins}m ${secs}s`;
        }

        tick();
        setInterval(tick, 1000);
      }
      startCountdown(next.date);

      /* -------------------------------
         LEAGUE TABLE + PREVIOUS MATCHES
      --------------------------------*/
      const container = document.getElementById("tablesContainer");
      container.innerHTML = "";

      const years = Object.keys(data.matchesByYear).sort((a,b)=>b-a);

      years.forEach(year => {
        const matches = data.matchesByYear[year];

        container.innerHTML += `
          <h2 class="text-center mt-5">${year}</h2>

          <h3 class="mt-4">League Table</h3>
          <table class="table table-bordered table-hover mb-5" id="table${year}">
            <thead class="thead-dark">
              <tr>
                <th>#</th><th>Team</th><th>P</th><th>W</th><th>D</th><th>L</th>
                <th>GF</th><th>GA</th><th>GD</th><th>Pts</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <h3 class="mt-4 mb-3">Previous Matches</h3>
          <table class="table table-striped table-bordered mb-5">
            <thead class="thead-dark">
              <tr>
                <th>Date</th>
                <th>Home</th>
                <th>Score</th>
                <th>Away</th>
                <th>Players</th>
              </tr>
            </thead>
            <tbody id="matches${year}"></tbody>
          </table>
        `;

        /* Fill matches */
        const matchesBody = document.getElementById("matches"+year);

        matchesBody.innerHTML = matches.map(match => `
          <tr>
            <td>${match.date}</td>
            <td>${match.home==="CRNI" ? "<span class='team-crni'>CRNI</span>" : "<span class='team-beli'>BELI</span>"}</td>
            <td>${match.score}</td>
            <td>${match.away==="CRNI" ? "<span class='team-crni'>CRNI</span>" : "<span class='team-beli'>BELI</span>"}</td>
            <td>
              <b>CRNI:</b> ${match.players.CRNI.join(", ")}<br>
              <b>BELI:</b> ${match.players.BELI.join(", ")}
            </td>
          </tr>
        `).join("");

        /* Calculate league table */
        const stats = {};

        matches.forEach(m => {
          const [h,a] = m.score.split(":").map(Number);

          if (!stats[m.home]) stats[m.home] = {team:m.home, played:0, won:0, draw:0, lost:0, gf:0, ga:0, points:0};
          if (!stats[m.away]) stats[m.away] = {team:m.away, played:0, won:0, draw:0, lost:0, gf:0, ga:0, points:0};

          stats[m.home].played++;
          stats[m.away].played++;

          stats[m.home].gf+=h; stats[m.home].ga+=a;
          stats[m.away].gf+=a; stats[m.away].ga+=h;

          if (h>a) {
            stats[m.home].won++; stats[m.home].points+=3; stats[m.away].lost++;
          } else if (a>h) {
            stats[m.away].won++; stats[m.away].points+=3; stats[m.home].lost++;
          } else {
            stats[m.home].draw++; stats[m.away].draw++;
            stats[m.home].points++; stats[m.away].points++;
          }
        });

        const arr = Object.values(stats).map(t => ({...t, gd:t.gf-t.ga}));

        arr.sort((a,b)=>
          b.points - a.points ||
          b.gd - a.gd ||
          b.gf - a.gf
        );

        const tb = document.querySelector(`#table${year} tbody`);

        tb.innerHTML = arr.map((t,i) => `
          <tr class="${i===0?'league-top':''}">
            <td>${i+1}</td>
            <td>
              <img class="league-table-logo" src="${
                t.team==="CRNI"
                ? "https://upload.wikimedia.org/wikipedia/de/d/d2/Juventus_Turin.svg"
                : "https://upload.wikimedia.org/wikipedia/en/thumb/5/56/Real_Madrid_CF.svg/960px-Real_Madrid_CF.svg.png"
              }"> ${t.team}
            </td>
            <td>${t.played}</td>
            <td>${t.won}</td>
            <td>${t.draw}</td>
            <td>${t.lost}</td>
            <td>${t.gf}</td>
            <td>${t.ga}</td>
            <td>${t.gd}</td>
            <td>${t.points}</td>
          </tr>
        `).join("");

      }); // years loop

      /* -------------------------------
         PLAYER STATS
      --------------------------------*/
      const appearanceMap = {};

      Object.values(data.matchesByYear).forEach(year => {
        year.forEach(m => {
          m.players.CRNI.forEach(p => {
            if (!appearanceMap[p]) appearanceMap[p]={crni:0,beli:0};
            appearanceMap[p].crni++;
          });
          m.players.BELI.forEach(p => {
            if (!appearanceMap[p]) appearanceMap[p]={crni:0,beli:0};
            appearanceMap[p].beli++;
          });
        });
      });

      const playerStats = Object.entries(appearanceMap).map(([name,st]) => ({
        name,
        crni: st.crni,
        beli: st.beli,
        total: st.crni + st.beli
      }));

      playerStats.sort((a,b)=>b.total-a.total);

      const statsBody = document.getElementById("playerStatsBody");

      statsBody.innerHTML = playerStats.map((p,i)=>`
        <tr>
          <td>${i+1}</td>
          <td>${p.name}</td>
          <td>${p.crni}</td>
          <td>${p.beli}</td>
          <td>${p.total}</td>
        </tr>
      `).join("");

    }); // JSON loaded
}); // DOM ready
</script>

<!-- Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</body>
</html>
